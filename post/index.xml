<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Leo Sheu 的日常筆記</title><link>https://blog.sheu.pw/post/</link><description>Recent content in Posts on Leo Sheu 的日常筆記</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><lastBuildDate>Sun, 07 Aug 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.sheu.pw/post/index.xml" rel="self" type="application/rss+xml"/><item><title>所有的 Class 都要加 Interface 嗎?</title><link>https://blog.sheu.pw/p/why-add-interface/</link><pubDate>Sun, 07 Aug 2022 00:00:00 +0000</pubDate><guid>https://blog.sheu.pw/p/why-add-interface/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-C#" data-lang="C#">&lt;span class="line">&lt;span class="cl">&lt;span class="k">interface&lt;/span> &lt;span class="nc">ITextSummarizer&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">string&lt;/span> &lt;span class="n">summarizeText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">text&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">TextSummarizer&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">ITextSummarizer&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">string&lt;/span> &lt;span class="n">summarizeText&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">text&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">//do something&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;summarize text&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>雖然 TextSummarizer 只有一個實作，就算之後不會有另一個實作，加上 interface 也有其他好處。&lt;/p>
&lt;p>定義 interface 的優點：&lt;/p>
&lt;ul>
&lt;li>可以使測試更容易 - 如果要在測試期間使用 mock 或 fake 假的實作，會需要定義一個介面來執行此操作。&lt;/li>
&lt;li>讓公用 API 更清晰 - 使用端應該或不應該使用哪些功能不會產生混淆。&lt;/li>
&lt;li>有可能猜錯只需要一個實作 - 最初寫程式時可能確定真的不需要第二個實作，但經過一兩個月後，這個假設可能被證明是錯誤的。&lt;/li>
&lt;li>同一類別可以解決兩個子問題 - 有時某個類別可以為兩個或多個不同的抽象層提供實作。例如 LinkedList 實作類別可以實作 List 和 Queue 介面。&lt;/li>
&lt;/ul>
&lt;p>定義 interface 的缺點：&lt;/p>
&lt;ul>
&lt;li>需要付出更多努力 - 如果沒有 IDE 的幫忙，可能要手動多寫幾行程式碼。
-&amp;gt; &lt;a class="link" href="https://www.jetbrains.com/help/rider/Refactorings__Extract_Interface.html" target="_blank" rel="noopener"
>使用 Rider 自動產生 Interface&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;p>Reference&lt;/p>
&lt;blockquote>
&lt;p>&lt;a class="link" href="https://www.tenlong.com.tw/products/9786263242128" target="_blank" rel="noopener"
>Good Code, Bad Code｜寫出高品質的程式碼&lt;/a> PART 1 理論篇 - 第2章 抽象層&lt;/p>
&lt;/blockquote></description></item><item><title>Hugo start</title><link>https://blog.sheu.pw/p/hugo-start/</link><pubDate>Sun, 31 Jul 2022 00:00:00 +0000</pubDate><guid>https://blog.sheu.pw/p/hugo-start/</guid><description>&lt;img src="https://blog.sheu.pw/p/hugo-start/hugo-logo.svg" alt="Featured image of post Hugo start" />&lt;p>[Windows]
透過 &lt;a class="link" href="https://scoop.sh/" target="_blank" rel="noopener"
>Scoop&lt;/a> 安裝：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">scoop&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">hugo&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Hugo start： &lt;a class="link" href="https://gohugo.io/getting-started/quick-start" target="_blank" rel="noopener"
>https://gohugo.io/getting-started/quick-start/&lt;/a>&lt;/p>
&lt;p>Theme： &lt;a class="link" href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
>https://github.com/CaiJimmy/hugo-theme-stack&lt;/a>&lt;/p>
&lt;p>Run server (include content marked as draft)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-powershell" data-lang="powershell">&lt;span class="line">&lt;span class="cl">&lt;span class="n">hugo&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="n">-D&lt;/span> &lt;span class="n">-p&lt;/span> &lt;span class="n">8888&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>使用 Autofac KeyFilter Attribute 在相同介面注入不同實體</title><link>https://blog.sheu.pw/p/autofac-keyfilter-attribute/</link><pubDate>Fri, 22 Jul 2022 00:00:00 +0000</pubDate><guid>https://blog.sheu.pw/p/autofac-keyfilter-attribute/</guid><description>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-C#" data-lang="C#">&lt;span class="line">&lt;span class="cl">&lt;span class="k">interface&lt;/span> &lt;span class="nc">IAlertService&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">void&lt;/span> &lt;span class="n">SendAlert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">SlackAlertService&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">IAlertService&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">SendAlert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">){}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">TelegramAlertService&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">IAlertService&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">public&lt;/span> &lt;span class="k">void&lt;/span> &lt;span class="n">SendAlert&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span> &lt;span class="n">message&lt;/span>&lt;span class="p">){}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>假如有個 TestAlertService 需要同時使用到 SlackAlertService 和 TelegramAlertService ，在使用 autofac 注入時因為兩個 service 都使用相同的介面，這個時候可以透過加上 KeyFilter attribute 的方式來指定所需要的實體。&lt;/p>
&lt;p>KeyFilter 的使用方式：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-C#" data-lang="C#">&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">TestAlertService&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">IAlertService&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">public&lt;/span> &lt;span class="n">TestAlertService&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">KeyFilter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;slack&amp;#34;&lt;/span>&lt;span class="p">)]&lt;/span> &lt;span class="n">IAlertService&lt;/span> &lt;span class="n">slackAlert&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">KeyFilter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;telegram&amp;#34;&lt;/span>&lt;span class="p">)]&lt;/span> &lt;span class="n">IAlertService&lt;/span> &lt;span class="n">slackAlert&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>在註冊時需要透過設定好的 key 去指定相對應的實作，以及設定哪個類別要使用 attribute filter：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-C#" data-lang="C#">&lt;span class="line">&lt;span class="cl">&lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">RegisterType&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">SlackAlertService&lt;/span>&lt;span class="p">&amp;gt;().&lt;/span>&lt;span class="n">Keyed&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">IAlertService&lt;/span>&lt;span class="p">&amp;gt;(&lt;/span>&lt;span class="s">&amp;#34;slack&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">RegisterType&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">TelegramAlertService&lt;/span>&lt;span class="p">&amp;gt;().&lt;/span>&lt;span class="n">Keyed&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">IAlertService&lt;/span>&lt;span class="p">&amp;gt;(&lt;/span>&lt;span class="s">&amp;#34;telegram&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">builder&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">RegisterType&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">TestAlertService&lt;/span>&lt;span class="p">&amp;gt;().&lt;/span>&lt;span class="n">As&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">IAlertService&lt;/span>&lt;span class="p">&amp;gt;().&lt;/span>&lt;span class="n">WithAttributeFiltering&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;p>參考資料：&lt;a class="link" href="https://autofac.readthedocs.io/en/latest/advanced/keyed-services.html?highlight=named#resolving-with-attributes" target="_blank" rel="noopener"
>[Autofac] resolving with attributes&lt;/a>&lt;/p></description></item><item><title>如何查詢 w3wp.exe 對應的 IIS Application Pool</title><link>https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/</link><pubDate>Thu, 02 Sep 2021 00:00:00 +0000</pubDate><guid>https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/</guid><description>&lt;p>on Windows 2012 (IIS 8)&lt;/p>
&lt;ol>
&lt;li>
&lt;p>選擇想要檢視的 IIS Worker Process&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/w3wp-1.png"
width="650"
height="412"
srcset="https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/w3wp-1_hub29babf6175394838e5c78e03b7ce5a7_46549_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/w3wp-1_hub29babf6175394838e5c78e03b7ce5a7_46549_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="157"
data-flex-basis="378px"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>切到 detail 查看該 process 的 PID&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/w3wp-2.png"
width="650"
height="357"
srcset="https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/w3wp-2_huc407bfe8864868fca295eada6294ab55_51189_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/w3wp-2_huc407bfe8864868fca295eada6294ab55_51189_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="182"
data-flex-basis="436px"
>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>切換到 C:\Windows\System32\inetsrv ，執行 &lt;code>.\appcmd.exe list wp&lt;/code> 找到對應的 PID&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/w3wp-3.png"
width="677"
height="343"
srcset="https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/w3wp-3_huf1ef8aeac24f219555e550f01d095eca_19525_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%A6%82%E4%BD%95%E6%9F%A5%E8%A9%A2-w3wp.exe-%E5%B0%8D%E6%87%89%E7%9A%84-iis-application-pool/w3wp-3_huf1ef8aeac24f219555e550f01d095eca_19525_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="197"
data-flex-basis="473px"
>&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>台灣網路資訊中心 域名管理關鍵 Key 共用漏洞</title><link>https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/</link><pubDate>Wed, 10 Mar 2021 00:00:00 +0000</pubDate><guid>https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/</guid><description>&lt;p>某天逛 Facebook 突然發現有個「中文化電子郵件信箱體驗活動」，只要動動手指就可以體驗看起來很狂的中文信箱地址，而且還附贈該中文網域名稱一年，就趕緊就來申請囉。&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-1.png"
width="1280"
height="642"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-1_hu80b091ff53f3db5b4656c6844e437b96_491401_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-1_hu80b091ff53f3db5b4656c6844e437b96_491401_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="199"
data-flex-basis="478px"
>&lt;/p>
&lt;p>在經過很多步驟和教學後，終於拿到了成功獲得域名通知信，信中給了個連結可以設定管理網域的判別密碼。&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-2.png"
width="828"
height="401"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-2_hu7cbc7f6099b2b33429abb9cb195bae74_65622_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-2_hu7cbc7f6099b2b33429abb9cb195bae74_65622_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="206"
data-flex-basis="495px"
>&lt;/p>
&lt;p>可以看到設定判別密碼的網址帶了兩個參數 key 及 dn，key 是一串亂碼，而 dn 則是個人中文網域名稱 (灰色方塊部分)。&lt;/p>
&lt;p>-&amp;gt;透過此網址可重複修改密碼&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-3.png"
width="917"
height="567"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-3_hu69c8fe13b8b744f8c9104fdd42f6b48a_310902_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-3_hu69c8fe13b8b744f8c9104fdd42f6b48a_310902_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="161"
data-flex-basis="388px"
>&lt;/p>
&lt;p>接著就收到一封邀請好友的信件，點擊信中連結輸入好友 Gmail 信箱，成功推廣可以有抽獎點數。&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-4.png"
width="1280"
height="491"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-4_hu98ad4a81ecba4400a0e3f015b88958d9_172890_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-4_hu98ad4a81ecba4400a0e3f015b88958d9_172890_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="260"
data-flex-basis="625px"
>&lt;/p>
&lt;p>但點進去推廣頁面，看了網址所帶的參數覺得怎麼有種似曾相識的感覺？&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-5.png"
width="982"
height="630"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-5_hu79ea708aeb1bb198cd7001ba21d08d4f_144329_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-5_hu79ea708aeb1bb198cd7001ba21d08d4f_144329_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="155"
data-flex-basis="374px"
>&lt;/p>
&lt;p>推廣頁面和設定密碼的頁面所使用的 key 竟然是同一把！&lt;/p>
&lt;p>如果任何人知道你的中文網域名稱及邀請頁面連結，代入 &lt;code>KEY&lt;/code> 及 &lt;code>網域名稱&lt;/code> 到設定密碼頁面，即可修改他人的判別密碼。&lt;/p>
&lt;p>&lt;a class="link" href="https://rs.twnic.net.tw/cgi-bin/eai/chgpass.cgi?key=" target="_blank" rel="noopener"
>https://rs.twnic.net.tw/cgi-bin/eai/chgpass.cgi?key=&lt;/a> {KEY} &amp;amp;dn= {網域名稱}.台灣&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-6.png"
width="1280"
height="656"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-6_hu6488018c6ef51a37eb9ff2c4f1bb0d2f_588262_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-6_hu6488018c6ef51a37eb9ff2c4f1bb0d2f_588262_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="195"
data-flex-basis="468px"
>&lt;/p>
&lt;p>用修改後的密碼登入就可以取得原域名擁有者的所有權限，可以更改 DNS 設定、查看或修改個人資料等等。&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-7.png"
width="748"
height="261"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-7_hue4109e8ad34467f42b9f77bf2cf8ef68_28474_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-7_hue4109e8ad34467f42b9f77bf2cf8ef68_28474_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="286"
data-flex-basis="687px"
>&lt;/p>
&lt;p>如果你公布了你的網域名稱，順便附上信中的推廣連結，等於是告訴人：來吧，可以幫我改密碼喔。&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-8.png"
width="900"
height="346"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-8_hu5ef58bf126b5281f8d69048269b4aaa3_65731_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-8_hu5ef58bf126b5281f8d69048269b4aaa3_65731_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="260"
data-flex-basis="624px"
>&lt;/p>
&lt;p>為了避免關鍵 key 外流，我推廣好友自己打 Gmail 信箱總安全了吧，這樣想就大錯特錯了！&lt;/p>
&lt;p>就算自己打信箱推廣，被推廣好友所收到確認信所含連結也有那把可以重設密碼的 key (右下黃色區塊)。總之，如果要推廣好友，絕對不能把我的網域名稱告訴他人，不然他就能幫忙改密碼並接管自己的個人網域了。&lt;/p>
&lt;p>-&amp;gt;同一人所發出邀請 key 皆相同，參數 rec 不同被推廣者皆不相同。&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-9.png"
width="946"
height="423"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-9_huef892dcf527c88c9e3d21bd6182bd03b_67227_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-9_huef892dcf527c88c9e3d21bd6182bd03b_67227_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="223"
data-flex-basis="536px"
>&lt;/p>
&lt;p>之後把情況詳情回報給台灣網路資訊中心，當天幾小時後重設密碼的頁面就自動跳轉到 &lt;a class="link" href="https://rs.twnic.net.tw/cgi-bin/eai/chgpass.cgi" target="_blank" rel="noopener"
>https://rs.twnic.net.tw/cgi-bin/eai/chgpass.cgi&lt;/a> 乾淨的網址，改成用 Form Data 的形式送出 key &amp;amp; dn，暫時先改變資料送出的形式，把漏洞變得比較不明顯。&lt;/p>
&lt;p>幸好隔天重設密碼的流程就換了，改成只回傳一個&amp;lt;script&amp;gt; alert，提示至信箱確認變更密碼連結，他人就不再能簡單取得個人網域權限了，當天的修改貌似只是不想讓更多人能一眼就發現並使用這個漏洞。&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-10.png"
width="830"
height="216"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-10_hu8b06fe22144b089a9988e26d0d0656d3_17172_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-10_hu8b06fe22144b089a9988e26d0d0656d3_17172_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="384"
data-flex-basis="922px"
>&lt;/p>
&lt;p>設定密碼的頁面所使用的 key (灰色部分) 終於不是那組連推廣都共用的那把了。&lt;/p>
&lt;p>&lt;img src="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-11.png"
width="991"
height="606"
srcset="https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-11_huc025ae6092f993191dbf600f0d19167c_306089_480x0_resize_box_3.png 480w, https://blog.sheu.pw/p/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83-%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E/twnic-11_huc025ae6092f993191dbf600f0d19167c_306089_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="392px"
>&lt;/p>
&lt;p>查了一下此活動開始也有一段時間了，不過看起來還沒有人發現。為了避免更多資料外洩，當天即送出了問題回報，他們也非常快速的解決了問題，在隔天即修復完成。除了讓人佩服工程師的努力外，正面面對漏洞修補的態度也值得讚賞。&lt;/p>
&lt;p>這個問題的根本原因就是重設密碼所用的 token 也被其他服務所使用，而該推廣中文域名活動的服務剛好會讓 token 流出給第三者，而讓外人可以輕易取得域名管理權限。&lt;/p>
&lt;p>其實只要多留意並不難發現這個漏洞，但它還是存在了幾個禮拜的時間，這也說明了網路上並不是沒有漏洞，而是缺少發現。身為使用者可以多仔細觀察，協助政府或企業發現問題。而開發者則要注意並不是使用亂數當 token 就安全，也要注意在設定密碼這種比較敏感的服務和其他一般服務所使用的 token 必須要有所區隔。&lt;/p>
&lt;p>時間軸：&lt;/p>
&lt;pre>&lt;code>2017/3/30：漏洞詳情回報給財團法人台灣網路資訊中心
2017/3/31：修復了此漏洞
&lt;/code>&lt;/pre>
&lt;p>本文同步刊載於 &lt;a class="link" href="https://kb.hitcon.org/post/159329007522/%E5%8F%B0%E7%81%A3%E7%B6%B2%E8%B7%AF%E8%B3%87%E8%A8%8A%E4%B8%AD%E5%BF%83%E5%9F%9F%E5%90%8D%E7%AE%A1%E7%90%86%E9%97%9C%E9%8D%B5-key-%E5%85%B1%E7%94%A8%E6%BC%8F%E6%B4%9E" target="_blank" rel="noopener"
>HITCON Knowledge Base&lt;/a> in 2017.04&lt;/p></description></item></channel></rss>